import{_ as W}from"./DdI5B-f_.js";import{q as X,r,s as Y,V as Z,v as V,h as G,o as m,x as _,w as o,B as u,c as J,t as ee,b as t,d as S,X as H,D as j,u as te,A as oe,C as se}from"./pfen37nC.js";import{u as ae,S as le,_ as ne,a as re}from"./CTWu3xNW.js";import{_ as ie}from"./DZE57Hj_.js";import{c as E,_ as ue,a as pe}from"./Ce1V9AIp.js";import{_ as ce}from"./CrSYGF1A.js";import{H as de,L as K,_ as me}from"./DjzlFm1z.js";import{u as fe}from"./yaBYm9bp.js";import{_ as _e}from"./BCgTLb-1.js";import{S as ve,a as ye,b as we,P as ge}from"./B8DQizlv.js";import{B as Q}from"./DaTCy0-P.js";import{S as ke}from"./BIMQPg20.js";import{I as Ce,_ as xe,a as $e,F as be}from"./BILk8unQ.js";import{M as he}from"./hDKACIxK.js";import{_ as Se}from"./CL9W64Bf.js";import{_ as Me,L as Oe}from"./CkqvxptD.js";import"./0ESeQ1G4.js";import"./D5PK9cSD.js";import"./zumCF4Wn.js";import"./YQznkyEo.js";import"./D73PgFZk.js";import"./4efXhTML.js";import"./CuwMMC_f.js";import"./C5j99dGK.js";import"./D6oZlt4w.js";import"./DGYNie3Z.js";import"./CuvLPzjN.js";import"./DL8rJm5r.js";import"./ZEWPwqxo.js";import"./CXPWXIeg.js";import"./vCu2co3e.js";import"./CgdMqucG.js";const Le={key:1},Fe=X({__name:"ClusterModal",props:{open:{type:Boolean},isEditing:{type:Boolean,default:!1},isLoading:{type:Boolean,default:!1},item:{default:()=>({})},title:{default:"Добавление хранилища"}},emits:["close","confirm"],setup(D,{emit:I}){const M=r(!1),P=Y(),y=D;fe();const{open:g,isEditing:c,isLoading:O,item:k}=Z(y),L=I,F=r(null),C=async()=>{var s,l,v;M.value=!0;try{const d=await((s=F.value)==null?void 0:s.validateFields());if(d&&!d.errorFields){const p={user_id:((l=P.user)==null?void 0:l.id)??"",password:n.password,name:n.name,...c.value&&{new_password:n.new_password,cluster_id:(v=k.value)==null?void 0:v.id}};console.log(p);const a=await(c.value?E.update:E.create)(p);L("confirm",a)}}catch(d){console.log(d)}finally{M.value=!1}},x=async()=>{var s;try{const l=await E.delete((s=k.value)==null?void 0:s.id);console.log(l),h()}catch(l){console.log(l)}},h=()=>{L("close")};r(null);const B=r(null),T=r(null),n=V({name:"",password:"",new_password:"",users:null});G(()=>k.value,s=>{c.value&&s&&(n.name=(s==null?void 0:s.name)??"",n.password=(s==null?void 0:s.password)??"",n.new_password="",n.users=(s==null?void 0:s.users)??null)},{immediate:!0}),G(()=>g.value,s=>{s&&(n.name="",n.password="",n.users=null,n.new_password=""),s||(F.value.resetFields(),w.value&&(B.value.resetForm(),w.value=!1),$.value&&(T.value.resetForm(),$.value=!1))});const w=r(!1),$=r(!1),q=()=>{$.value=!$.value},z=()=>{w.value=!w.value};return(s,l)=>{const v=ve,d=Q,p=Se,b=ye,a=we,e=ke,A=Ce,R=xe,U=$e,N=be,i=he;return m(),_(i,{open:u(g),onCancel:h,onOk:C},{title:o(()=>[u(O)?(m(),_(v,{key:0,paragraph:{rows:0},active:""})):(m(),J("div",Le,ee(s.title),1))]),footer:o(()=>[u(c)?(m(),_(p,{key:0,justify:"space-between",wrap:"wrap"},{default:o(()=>[t(d,{type:"link",danger:"",onClick:l[0]||(l[0]=f=>x())},{default:o(()=>[S("Удалить хранилище")]),_:1}),t(d,{type:"primary",onClick:l[1]||(l[1]=f=>C())},{default:o(()=>[S("Сохранить")]),_:1})]),_:1})):(m(),_(d,{key:"submit",type:"primary",loading:M.value,onClick:C},{default:o(()=>[S("Добавить хранилище")]),_:1},8,["loading"]))]),default:o(()=>[u(O)?(m(),_(e,{key:0,class:"w-[250px]",direction:"vertical"},{default:o(()=>[t(p,{justify:"space-between",wrap:"wrap"},{default:o(()=>[t(b,{active:""})]),_:1}),t(p,{justify:"space-between",wrap:"wrap"},{default:o(()=>[t(b,{active:""}),t(a,{active:""})]),_:1}),t(p,{justify:"space-between",wrap:"wrap"},{default:o(()=>[t(b,{class:"flex-grow",active:""})]),_:1}),t(p,{justify:"space-between",wrap:"wrap"},{default:o(()=>[t(b,{class:"flex-grow",active:""}),t(a,{active:""})]),_:1})]),_:1})):(m(),_(N,{key:1,ref_key:"clusterModal",ref:F,layout:"vertical",model:n,name:"basic",autocomplete:"off"},{default:o(()=>[t(R,{name:"name",class:"w-[340px]",rules:[{required:!0,message:"Введите название хранилища"}]},{default:o(()=>[t(A,{value:n.name,"onUpdate:value":l[2]||(l[2]=f=>n.name=f),class:"text-gray-400",placeholder:"Название хранилища"},{prefix:o(()=>[t(u(de),{size:20,color:"currentColor"})]),_:1},8,["value"])]),_:1}),t(p,{wrap:"wrap",gap:4},{default:o(()=>[t(R,{class:H(u(c)?"w-full":"w-[340px]"),name:"password",rules:[{required:!0,message:"Введите пароль"}]},{default:o(()=>[t(U,{value:n.password,"onUpdate:value":l[3]||(l[3]=f=>n.password=f),class:"text-gray-400",placeholder:"Введите пароль"},{prefix:o(()=>[t(u(K),{size:20,color:"currentColor"})]),_:1},8,["value"])]),_:1},8,["class"]),u(c)?(m(),_(R,{key:0,class:H(u(c)?"w-full":"w-[340px]"),name:"new_password"},{default:o(()=>[t(U,{value:n.new_password,"onUpdate:value":l[4]||(l[4]=f=>n.new_password=f),class:"text-gray-400",placeholder:"Введите новый пароль"},{prefix:o(()=>[t(u(K),{size:20,color:"currentColor"})]),_:1},8,["value"])]),_:1},8,["class"])):j("",!0),u(c)?j("",!0):(m(),_(p,{key:1,vertical:"",gap:4},{default:o(()=>[t(d,{type:"primary",class:"flex-grow",ghost:"",onClick:l[5]||(l[5]=f=>z())},{default:o(()=>[S("Проверить")]),_:1}),t(d,{type:"primary",class:"flex-grow",ghost:"",onClick:l[6]||(l[6]=f=>q())},{default:o(()=>[S("Генерировать")]),_:1})]),_:1}))]),_:1}),w.value?(m(),_(me,{key:0,ref_key:"leaksFormRef",ref:B,class:"my-4"},null,512)):j("",!0),$.value?(m(),_(_e,{key:1,ref_key:"generateFormRef",ref:T,class:"my-4"},null,512)):j("",!0)]),_:1},8,["model"]))]),_:1},8,["open"])}}}),Be={class:"h-full"},pt=X({__name:"index",setup(D){const{typeOfView:I,changeTypeOfView:M}=ae(le.CLUSTER_TYPE),P=Y();r("");const y=r({typeOfAuth:"create",clusterId:0}),g=r(!1),c=(a=0,e="create")=>{console.log(e),e==="create"&&(g.value=!0),e==="edit"&&n(a,e),e==="open"&&n(a,e)},O=()=>{g.value=!1,p.value=!1,d.value=null},k=r(!1),L=r("Авторизация"),F=r(!1),C=r(!1),x=r([]),h=async()=>{v.value=!0;try{const a={user_id:P.getUser.id},e=await E.list(a);x.value=e,console.log(x.value)}catch(a){console.log(a)}finally{v.value=!1}},B=()=>{F.value=!1},T=r(""),n=(a,e)=>{k.value=!0,L.value="Авторизация в хранилище",y.value.typeOfAuth=e,y.value.clusterId=a},w=()=>{k.value=!1,T.value="",y.value.typeOfAuth="create",y.value.id=0},$=te(),q=async({data:a,type:e})=>{console.log("data: ",a);try{w(),e==="edit"&&(g.value=!0,p.value=!0,d.value=a),e==="open"&&await $.push({path:`/platform/records/${a.id}`})}catch(A){console.log(A)}},z=()=>{C.value=!0,setTimeout(()=>{C.value=!1,B()},2e3)},s=r(!1),l=async a=>{s.value=!0;try{await h(),O()}catch(e){console.log(e)}finally{v.value=!1}},v=r(!1),d=r(null),p=r(!1);oe(async()=>{await P.profile(),await h()});const b=async a=>{v.value=!0;try{if(!a.length)await h();else{const e=await E.search({find:a});console.log(e),x.value=e}}catch(e){console.log(e)}finally{v.value=!1}};return(a,e)=>{const A=Q,R=W,U=Oe,N=Me;return m(),J("div",Be,[t(R,{class:"mt-4",title:"Личное хранилище"},{right:o(()=>[t(A,{type:"primary",size:"middle",icon:("h"in a?a.h:u(se))(u(ge)),onClick:e[0]||(e[0]=i=>c())},{default:o(()=>[S("Добавить хранилище")]),_:1},8,["icon"])]),_:1}),t(N,{class:"bg-white h-full"},{default:o(()=>[t(u(ne),{"type-view":u(I),onSearch:e[1]||(e[1]=i=>b(i)),onChangeView:e[2]||(e[2]=i=>u(M)(i))},null,8,["type-view"]),t(U,{class:"mt-6 px-4"},{default:o(()=>[x.value.length?(m(),_(re,{key:1,items:x.value,"type-view":u(I),"button-text":"Добавить хранилище",onAdd:e[6]||(e[6]=i=>c())},{card:o(({item:i})=>[t(ce,{item:i,"is-owner":!0,onEdit:e[4]||(e[4]=f=>c(f,"edit")),onOpen:e[5]||(e[5]=f=>c(f,"open"))},null,8,["item"])]),_:1},8,["items","type-view"])):(m(),_(ie,{key:0,title:"Oooopsss... Добавьте хранилище","button-title":"Добавить хранилище",onTrigger:e[3]||(e[3]=i=>c())})),t(ue,{"modal-title":"Пользователи кластера",class:"max-w-[600px]",loading:C.value,open:!1,onClose:e[7]||(e[7]=i=>B()),onSubmit:e[8]||(e[8]=i=>z())},null,8,["loading"]),t(pe,{"cluster-id":y.value.clusterId,type:y.value.typeOfAuth,"modal-title":L.value,class:"max-w-[600px]",loading:s.value,open:k.value,onClose:e[9]||(e[9]=i=>w()),onSubmit:e[10]||(e[10]=i=>q(i))},null,8,["cluster-id","type","modal-title","loading","open"]),t(Fe,{open:g.value,"is-editing":p.value,"is-loading":v.value,title:p.value?"Радактирование хранилища":"Добавление хранилища",item:d.value,onClose:e[11]||(e[11]=i=>O()),onConfirm:e[12]||(e[12]=i=>l(i))},null,8,["open","is-editing","is-loading","title","item"])]),_:1})]),_:1})])}}});export{pt as default};
