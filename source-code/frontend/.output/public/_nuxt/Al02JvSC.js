import{_ as oe}from"./DdJQVxg6.js";import{q as G,a7 as Z,o as p,c as Q,a as T,t as Y,$ as n,b as t,a8 as se,v as V,h as J,x as y,ad as ae,w as o,r as c,s as ee,d as L,ae as W,a1 as N,u as le,ac as ne,a5 as re}from"./DutA6s4s.js";import{S as ie,u as ue,a as ce,_ as de,b as pe}from"./59bztQ-X.js";import{_ as me}from"./BzkKGvdw.js";import{c as j,_ as fe,a as _e}from"./Enrevnmq.js";import{d as ve,I as ge,_ as ye,a as we,F as ke}from"./DQy1XneP.js";import{S as Ce}from"./ClgfcykS.js";import{S as he}from"./CArfcuWs.js";import{H as xe,L as X,_ as be,S as $e}from"./GqXCqae9.js";import{u as Se}from"./BtrZ7jwe.js";import{_ as Me}from"./BL6Np12V.js";import{S as Oe,a as Fe,b as Le,P as Be}from"./BFGb0XXS.js";import{B as te}from"./o1aMqsoj.js";import{M as Ie}from"./fAwOVESI.js";import{_ as Ue}from"./BsPBNx6V.js";import{_ as Re,L as Ae}from"./Tss58tcD.js";import"./C2x6kZgX.js";import"./CXt5RldZ.js";import"./D-QVxuq2.js";import"./DqJXAqIy.js";import"./BKdPbglU.js";import"./BEw11EN_.js";import"./BhUrNZtK.js";import"./BIOXidme.js";import"./CUKOJPN6.js";import"./9LVLI3pQ.js";import"./JmFmEmiP.js";import"./DGYNie3Z.js";import"./CQoVwa6u.js";import"./BSJ7Y3lW.js";import"./CpCLeKBI.js";const Ee={class:"flex flex-col gap-2"},Pe={class:"font-bold text-md"},Te={class:"text-gray-400 font-medium"},je=G({__name:"ClusterCard",props:{item:{}},emits:["edit","open"],setup(B,{emit:h}){const u=B,{item:k}=Z(u),m=h;return(_,s)=>(p(),Q("div",{class:"relative p-4 rounded border border-solid border-gray-400 flex items-center gap-4 hover:shadow transition-all cursor-pointer relative",onClick:s[1]||(s[1]=C=>m("open",n(k).id))},[T("div",Ee,[T("div",Pe,Y(n(k).name),1),T("div",Te,Y(n(k).created),1)]),T("div",{class:"absolute top-4 right-2 text-gray-400 transition-all hover:text-blue-400",onClick:s[0]||(s[0]=se(C=>m("edit",n(k).id),["stop"]))},[t(n(ie),{color:"currentColor"})])]))}}),ze=G({__name:"ClusterUsersSelect",setup(B){let h=0;const u=V({data:[],value:[],fetching:!1}),k=ve(m=>{console.log("fetching user",m),h+=1;const _=h;u.data=[],u.fetching=!0,fetch("https://randomuser.me/api/?results=5").then(s=>s.json()).then(s=>{if(_!==h)return;const C=s.results.map(v=>({label:`${v.name.first} ${v.name.last}`,value:v.login.username}));u.data=C,u.fetching=!1})},300);return J(u.value,()=>{u.data=[],u.fetching=!1}),(m,_)=>{const s=Ce,C=he;return p(),y(C,{value:u.value,"onUpdate:value":_[0]||(_[0]=v=>u.value=v),mode:"multiple","label-in-value":"",placeholder:"Выбрать сотрудника",style:{width:"100%"},"filter-option":!1,"not-found-content":u.fetching?void 0:null,options:u.data,onSearch:n(k)},ae({_:2},[u.fetching?{name:"notFoundContent",fn:o(()=>[t(s,{size:"small"})]),key:"0"}:void 0]),1032,["value","not-found-content","options","onSearch"])}}}),qe={key:1},Ne=T("div",{class:"mb-2 font-bold"},"Доступ для сотрудников",-1),Ge=G({__name:"ClusterModal",props:{open:{type:Boolean},isEditing:{type:Boolean,default:!1},isLoading:{type:Boolean,default:!1},item:{default:()=>({})},title:{default:"Добавление хранилища"}},emits:["close","confirm"],setup(B,{emit:h}){const u=c(!1),k=ee(),m=B;Se();const{open:_,isEditing:s,isLoading:C,item:v}=Z(m),I=h,U=c(null),S=async()=>{var a,l;u.value=!0;try{const g=await((a=U.value)==null?void 0:a.validateFields());if(g&&!g.errorFields){const w={user_id:k.getUser.id,password:r.password,name:r.name,...s.value&&{new_password:r.new_password,cluster_id:(l=v.value)==null?void 0:l.id}};console.log(w);const $=await(s.value?j.update:j.create)(w);I("confirm",$)}}catch(g){console.log(g)}finally{u.value=!1}},M=async()=>{var a;try{const l=await j.delete((a=v.value)==null?void 0:a.id);console.log(l),F()}catch(l){console.log(l)}},F=()=>{I("close")};c(null);const R=c(null),z=c(null),r=V({name:"",password:"",new_password:"",users:null});J(()=>v.value,a=>{s.value&&a&&(r.name=(a==null?void 0:a.name)??"",r.password=(a==null?void 0:a.password)??"",r.new_password="",r.users=(a==null?void 0:a.users)??null)},{immediate:!0}),J(()=>_.value,a=>{a&&(r.name="",r.password="",r.users=null,r.new_password=""),a||(U.value.resetFields(),b.value&&(R.value.resetForm(),b.value=!1),O.value&&(z.value.resetForm(),O.value=!1))});const b=c(!1),O=c(!1),H=()=>{O.value=!O.value},K=()=>{b.value=!b.value};return(a,l)=>{const g=Oe,w=te,f=Ue,$=Fe,i=Le,e=$e,A=ge,E=ye,q=we,D=ze,d=ke,P=Ie;return p(),y(P,{open:n(_),onCancel:F,onOk:S},{title:o(()=>[n(C)?(p(),y(g,{key:0,paragraph:{rows:0},active:""})):(p(),Q("div",qe,Y(a.title),1))]),footer:o(()=>[n(s)?(p(),y(f,{key:0,justify:"space-between",wrap:"wrap"},{default:o(()=>[t(w,{type:"link",danger:"",onClick:l[0]||(l[0]=x=>M())},{default:o(()=>[L("Удалить хранилище")]),_:1}),t(w,{type:"primary",onClick:l[1]||(l[1]=x=>S())},{default:o(()=>[L("Сохранить")]),_:1})]),_:1})):(p(),y(w,{key:"submit",type:"primary",loading:u.value,onClick:S},{default:o(()=>[L("Добавить хранилище")]),_:1},8,["loading"]))]),default:o(()=>[n(C)?(p(),y(e,{key:0,class:"w-[250px]",direction:"vertical"},{default:o(()=>[t(f,{justify:"space-between",wrap:"wrap"},{default:o(()=>[t($,{active:""})]),_:1}),t(f,{justify:"space-between",wrap:"wrap"},{default:o(()=>[t($,{active:""}),t(i,{active:""})]),_:1}),t(f,{justify:"space-between",wrap:"wrap"},{default:o(()=>[t($,{class:"flex-grow",active:""})]),_:1}),t(f,{justify:"space-between",wrap:"wrap"},{default:o(()=>[t($,{class:"flex-grow",active:""}),t(i,{active:""})]),_:1})]),_:1})):(p(),y(d,{key:1,ref_key:"clusterModal",ref:U,layout:"vertical",model:r,name:"basic",autocomplete:"off"},{default:o(()=>[t(E,{name:"name",class:"w-[340px]",rules:[{required:!0,message:"Введите название хранилища"}]},{default:o(()=>[t(A,{value:r.name,"onUpdate:value":l[2]||(l[2]=x=>r.name=x),class:"text-gray-400",placeholder:"Название хранилища"},{prefix:o(()=>[t(n(xe),{size:20,color:"currentColor"})]),_:1},8,["value"])]),_:1}),t(f,{wrap:"wrap",gap:4},{default:o(()=>[t(E,{class:W(n(s)?"w-full":"w-[340px]"),name:"password",rules:[{required:!0,message:"Введите пароль"}]},{default:o(()=>[t(q,{value:r.password,"onUpdate:value":l[3]||(l[3]=x=>r.password=x),class:"text-gray-400",placeholder:"Введите пароль"},{prefix:o(()=>[t(n(X),{size:20,color:"currentColor"})]),_:1},8,["value"])]),_:1},8,["class"]),n(s)?(p(),y(E,{key:0,class:W(n(s)?"w-full":"w-[340px]"),name:"new_password"},{default:o(()=>[t(q,{value:r.new_password,"onUpdate:value":l[4]||(l[4]=x=>r.new_password=x),class:"text-gray-400",placeholder:"Введите новый пароль"},{prefix:o(()=>[t(n(X),{size:20,color:"currentColor"})]),_:1},8,["value"])]),_:1},8,["class"])):N("",!0),n(s)?N("",!0):(p(),y(f,{key:1,vertical:"",gap:4},{default:o(()=>[t(w,{type:"primary",class:"flex-grow",ghost:"",onClick:l[5]||(l[5]=x=>K())},{default:o(()=>[L("Проверить")]),_:1}),t(w,{type:"primary",class:"flex-grow",ghost:"",onClick:l[6]||(l[6]=x=>H())},{default:o(()=>[L("Генерировать")]),_:1})]),_:1}))]),_:1}),t(f,{vertical:""},{default:o(()=>[Ne,t(D)]),_:1}),b.value?(p(),y(be,{key:0,ref_key:"leaksFormRef",ref:R,class:"my-4"},null,512)):N("",!0),O.value?(p(),y(Me,{key:1,ref_key:"generateFormRef",ref:z,class:"my-4"},null,512)):N("",!0)]),_:1},8,["model"]))]),_:1},8,["open"])}}}),He={class:"h-full"},ht=G({__name:"index",setup(B){const{typeOfView:h,changeTypeOfView:u}=ue(ce.CLUSTER_TYPE),k=ee();c("");const m=c({typeOfAuth:"create",clusterId:0}),_=c(!1),s=(i=0,e="create")=>{console.log(e),e==="create"&&(_.value=!0),e==="edit"&&r(i,e),e==="open"&&r(i,e)},C=()=>{_.value=!1,f.value=!1,w.value=null},v=c(!1),I=c("Авторизация"),U=c(!1),S=c(!1),M=c([]),F=async()=>{g.value=!0;try{const i={user_id:k.getUser.id},e=await j.list(i);M.value=e,console.log(M.value)}catch(i){console.log(i)}finally{g.value=!1}},R=()=>{U.value=!1},z=c(""),r=(i,e)=>{v.value=!0,I.value="Авторизация в кластере",m.value.typeOfAuth=e,m.value.clusterId=i},b=()=>{v.value=!1,z.value="",m.value.typeOfAuth="create",m.value.id=0},O=le(),H=async({data:i,type:e})=>{try{b(),e==="edit"&&(_.value=!0,f.value=!0,w.value=i),e==="open"&&await O.push({path:`/platform/records/${i.id}`})}catch(A){console.log(A)}},K=()=>{S.value=!0,setTimeout(()=>{S.value=!1,R()},2e3)},a=c(!1),l=async i=>{a.value=!0;try{await F(),C()}catch(e){console.log(e)}finally{g.value=!1}},g=c(!1),w=c(null),f=c(!1);ne(async()=>{await k.profile(),await F()});const $=async i=>{g.value=!0;try{if(!i.length)await F();else{const e=await j.search({find:i});console.log(e),M.value=e}}catch(e){console.log(e)}finally{g.value=!1}};return(i,e)=>{const A=te,E=oe,q=Ae,D=Re;return p(),Q("div",He,[t(E,{class:"mt-4",title:"Хранилища"},{right:o(()=>[t(A,{type:"primary",size:"middle",icon:("h"in i?i.h:n(re))(n(Be)),onClick:e[0]||(e[0]=d=>s())},{default:o(()=>[L("Добавить хранилище")]),_:1},8,["icon"])]),_:1}),t(D,{class:"bg-white h-full"},{default:o(()=>[t(n(de),{"type-view":n(h),onSearch:e[1]||(e[1]=d=>$(d)),onChangeView:e[2]||(e[2]=d=>n(u)(d))},null,8,["type-view"]),t(q,{class:"mt-6 px-4"},{default:o(()=>[M.value.length?(p(),y(pe,{key:1,items:M.value,"type-view":n(h),"button-text":"Добавить хранилище",onAdd:e[6]||(e[6]=d=>s())},{card:o(({item:d})=>[t(je,{item:d,onEdit:e[4]||(e[4]=P=>s(P,"edit")),onOpen:e[5]||(e[5]=P=>s(P,"open"))},null,8,["item"])]),_:1},8,["items","type-view"])):(p(),y(me,{key:0,title:"Сейчас кластеры пусты ( ","button-title":"Добавить кластер",onTrigger:e[3]||(e[3]=d=>s())})),t(fe,{"modal-title":"Пользователи кластера",class:"max-w-[600px]",loading:S.value,open:!1,onClose:e[7]||(e[7]=d=>R()),onSubmit:e[8]||(e[8]=d=>K())},null,8,["loading"]),t(_e,{"cluster-id":m.value.clusterId,type:m.value.typeOfAuth,"modal-title":I.value,class:"max-w-[600px]",loading:a.value,open:v.value,onClose:e[9]||(e[9]=d=>b()),onSubmit:e[10]||(e[10]=d=>H(d))},null,8,["cluster-id","type","modal-title","loading","open"]),t(Ge,{open:_.value,"is-editing":f.value,"is-loading":g.value,title:f.value?"Радактирование хранилища":"Добавление хранилища",item:w.value,onClose:e[11]||(e[11]=d=>C()),onConfirm:e[12]||(e[12]=d=>l(d))},null,8,["open","is-editing","is-loading","title","item"])]),_:1})]),_:1})])}}});export{ht as default};
