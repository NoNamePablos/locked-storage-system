import{_ as ee}from"./DdJQVxg6.js";import{q as A,r as p,s as K,a7 as oe,v as te,h as H,o as c,x as m,w as o,$ as i,c as S,t as ae,b as e,d as _,a1 as B,a3 as T,ac as se,a as C,ag as ne,a5 as re,F as le}from"./DutA6s4s.js";import{H as ie,L as ce,_ as pe,S as de}from"./GqXCqae9.js";import{u as me}from"./BtrZ7jwe.js";import{_ as ue}from"./BL6Np12V.js";import{c as I}from"./B2qpgujR.js";import{S as _e,a as fe,b as ye,P as ve}from"./BFGb0XXS.js";import{B as J}from"./o1aMqsoj.js";import{I as Q,_ as ge,a as ke,F as we}from"./DQy1XneP.js";import{M as xe}from"./D_4CA6tq.js";import{M as be}from"./fAwOVESI.js";import{_ as Ce}from"./BsPBNx6V.js";import{_ as he}from"./ClgfcykS.js";import"./BIOXidme.js";import"./CUKOJPN6.js";import"./D-QVxuq2.js";import"./CpCLeKBI.js";import"./CArfcuWs.js";import"./BKdPbglU.js";import"./JmFmEmiP.js";import"./DGYNie3Z.js";import"./CXt5RldZ.js";import"./BSJ7Y3lW.js";import"./DqJXAqIy.js";import"./BEw11EN_.js";import"./BhUrNZtK.js";import"./9LVLI3pQ.js";import"./CQoVwa6u.js";const Ue={key:1},$e=A({__name:"CompanyModal",props:{open:{type:Boolean},isEditing:{type:Boolean,default:!1},isLoading:{type:Boolean,default:!1},item:{default:()=>({})},title:{default:"Добавление пользователя"}},emits:["close","confirm"],setup(D,{emit:w}){const f=p(!1),M=K(),R=D,{copy:E}=me(),{open:L,isEditing:h,isLoading:x,item:U}=oe(R),q=w,b=p(null),P=async()=>{var a;f.value=!0;try{const r=await((a=b.value)==null?void 0:a.validateFields());if(r&&!r.errorFields){const F={password:n.password,name:n.username,email:n.email,confirm_password:n.password,role:"user"},d=await I.registerUser(F);console.log(d);const s={company_id:M.getUser.owner.id,user_id:d.data.user.id};console.log(s);const u=await I.addUser(s);q("confirm",u)}}catch(r){console.log(r)}finally{f.value=!1}},O=()=>{q("close")},n=te({username:"",email:"",password:"",role:"user"});p(null);const $=p(null),v=p(null);H(()=>U.value,a=>{console.log(a),h.value&&a&&(n.username=(a==null?void 0:a.username)??"",n.email=(a==null?void 0:a.email)??"",n.password=(a==null?void 0:a.password)??"")},{immediate:!0}),H(()=>L.value,a=>{a&&(n.username="",n.email="",n.password=""),a||(b.value.resetFields(),g.value&&($.value.resetForm(),g.value=!1),t.value&&(v.value.resetForm(),t.value=!1))});const g=p(!1),t=p(!1),l=()=>{t.value=!t.value},k=()=>{g.value=!g.value},z=a=>{try{E(a),T.success("Данные скопированы")}catch{T.error("Ошибка копирования")}};return(a,r)=>{const F=_e,d=J,s=Ce,u=fe,j=ye,W=de,G=Q,N=ge,X=xe,Y=ke,Z=we,V=be;return c(),m(V,{open:i(L),onCancel:O,onOk:P},{title:o(()=>[i(x)?(c(),m(F,{key:0,paragraph:{rows:0},active:""})):(c(),S("div",Ue,ae(a.title),1))]),footer:o(()=>[i(h)?(c(),m(s,{key:0,justify:"space-between",wrap:"wrap"},{default:o(()=>[e(d,{type:"link",danger:""},{default:o(()=>[_("Удалить пользователя")]),_:1}),e(d,{type:"primary"},{default:o(()=>[_("Сохранить")]),_:1})]),_:1})):(c(),m(d,{key:"submit",type:"primary",loading:f.value,onClick:P},{default:o(()=>[_("Добавить пользователя")]),_:1},8,["loading"]))]),default:o(()=>[i(x)?(c(),m(W,{key:0,class:"w-[250px]",direction:"vertical"},{default:o(()=>[e(s,{justify:"space-between",wrap:"wrap"},{default:o(()=>[e(u,{active:""})]),_:1}),e(s,{justify:"space-between",wrap:"wrap"},{default:o(()=>[e(u,{active:""}),e(j,{active:""})]),_:1}),e(s,{justify:"space-between",wrap:"wrap"},{default:o(()=>[e(u,{class:"flex-grow",active:""})]),_:1}),e(s,{justify:"space-between",wrap:"wrap"},{default:o(()=>[e(u,{class:"flex-grow",active:""}),e(j,{active:""})]),_:1})]),_:1})):(c(),m(Z,{key:1,ref_key:"clusterModal",ref:b,layout:"vertical",model:n,name:"basic",autocomplete:"off"},{default:o(()=>[e(N,{name:"username",class:"w-[340px]",rules:[{required:!0,message:"Введите имя пользователя"}]},{default:o(()=>[e(G,{value:n.username,"onUpdate:value":r[0]||(r[0]=y=>n.username=y),class:"text-gray-400",placeholder:"Имя пользователя"},{prefix:o(()=>[e(i(ie),{size:20,color:"currentColor"})]),_:1},8,["value"])]),_:1}),e(N,{name:"email",rules:{required:!0,type:"email",message:"Please input your email!"}},{default:o(()=>[e(G,{value:n.email,"onUpdate:value":r[1]||(r[1]=y=>n.email=y),placeholder:"E-mail"},{prefix:o(()=>[e(X)]),_:1},8,["value"])]),_:1}),e(s,{wrap:"wrap",gap:4},{default:o(()=>[e(N,{class:"w-[340px]",name:"password",rules:[{required:!0,message:"Введите пароль"}]},{default:o(()=>[e(Y,{value:n.password,"onUpdate:value":r[2]||(r[2]=y=>n.password=y),class:"text-gray-400",placeholder:"Введите пароль"},{prefix:o(()=>[e(i(ce),{size:20,color:"currentColor"})]),_:1},8,["value"])]),_:1}),i(h)?(c(),m(d,{key:1,type:"primary",class:"flex-grow",ghost:"",onClick:r[5]||(r[5]=y=>z(n.password))},{default:o(()=>[_("Скопировать")]),_:1})):(c(),m(s,{key:0,vertical:"",gap:4},{default:o(()=>[e(d,{type:"primary",class:"flex-grow",ghost:"",onClick:r[3]||(r[3]=y=>k())},{default:o(()=>[_("Проверить")]),_:1}),e(d,{type:"primary",class:"flex-grow",ghost:"",onClick:r[4]||(r[4]=y=>l())},{default:o(()=>[_("Генерировать")]),_:1})]),_:1}))]),_:1}),g.value?(c(),m(pe,{key:0,ref_key:"leaksFormRef",ref:$,class:"my-4"},null,512)):B("",!0),t.value?(c(),m(ue,{key:1,ref_key:"generateFormRef",ref:v,class:"my-4"},null,512)):B("",!0)]),_:1},8,["model"]))]),_:1},8,["open"])}}}),Fe={class:"h-full"},Se={class:"mt-4 pb-6 px-4 flex w-full items-center flex-wrap justify-between border-solid border-transparent border-b-gray-200 border-0 border-b-[1px]"},Be={class:"max-w-[400px] mt-4 w-full"},Ie={class:"border-solid border-0 border-b-2 border-gray-400"},Me=C("div",null,[C("span",null,"Сортировка")],-1),Re={key:0},Le={key:1},io=A({__name:"index",setup(D){const w=p(!1),f=K(),M=p(null),R=p([]),E=async()=>{w.value=!0;try{const t=await I.show(f.getUser.owner.id);M.value=t}catch(t){console.log(t)}finally{w.value=!1}},L=async()=>{w.value=!0;try{const t=await I.users(f.getUser.owner.id);console.log(t),R.value=t.users}catch(t){console.log(t)}finally{w.value=!1}};se(async()=>{await f.profile(),await E(),await L()});const h=[{name:"ID",dataIndex:"id",key:"id"},{name:"Имя",dataIndex:"name",key:"name"},{title:"Email",dataIndex:"email",key:"email"},{title:"Роль",key:"role",dataIndex:"role"},{title:"Действия",key:"action"}],x=p(!1),U=p(!1),q=p(!1),b=p(null),P=t=>{console.log(t)},O=()=>{x.value=!1,U.value=!1,b.value=null},n=()=>{x.value=!0},$=async t=>{try{const l={company_id:f.getUser.owner.id,user_id:t},k=await I.deleteUser(l);console.log(k)}catch(l){console.log(l)}},v=p(""),g=async t=>{try{console.log(t)}catch(l){console.log(l)}};return(t,l)=>{var d;const k=J,z=ee,a=Q,r=he,F=$e;return c(),S("div",Fe,[e(z,{class:"mt-4",title:`Компания ${((d=i(M))==null?void 0:d.name)??""}`},{right:o(()=>[e(k,{type:"primary",size:"middle",icon:("h"in t?t.h:i(re))(i(ve)),onClick:l[0]||(l[0]=s=>n())},{default:o(()=>[_("Добавить пользователя")]),_:1},8,["icon"])]),_:1},8,["title"]),C("div",null,[C("div",Se,[C("div",Be,[C("div",Ie,[e(a,{value:i(v),"onUpdate:value":l[1]||(l[1]=s=>ne(v)?v.value=s:null),bordered:!1,placeholder:"Поиск...",class:"text-gray-400",onChange:l[2]||(l[2]=s=>g(s.target.value))},{prefix:o(()=>[e(i(v),{size:16,color:"currentColor"})]),_:1},8,["value"])])]),Me]),e(r,{columns:h,"data-source":i(R)},{headerCell:o(({column:s})=>[s.key==="name"?(c(),S("span",Re," Имя ")):B("",!0),s.key==="id"?(c(),S("span",Le," ID ")):B("",!0)]),bodyCell:o(({column:s,record:u})=>[s.key==="action"?(c(),S(le,{key:0},[e(k,{type:"link",danger:"",onClick:j=>$(u.id)},{default:o(()=>[_("Удалить")]),_:2},1032,["onClick"]),e(k,{type:"link",onClick:j=>$(u.id)},{default:o(()=>[_("Редактировать")]),_:2},1032,["onClick"])],64)):B("",!0)]),_:1},8,["data-source"])]),e(F,{open:i(x),"is-editing":i(U),"is-loading":i(q),title:i(U)?"Радактировать пользователя":"Добавление пользователя",item:i(b),onClose:l[3]||(l[3]=s=>O()),onConfirm:l[4]||(l[4]=s=>P(s))},null,8,["open","is-editing","is-loading","title","item"])])}}});export{io as default};
