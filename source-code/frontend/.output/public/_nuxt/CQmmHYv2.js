import{_ as K}from"./DdI5B-f_.js";import{q as A,r,s as P,V as Q,v as V,h as W,o as i,x,w as a,B as n,c as B,t as X,b as o,d as C,A as Y,a as U,an as Z,C as z,D,F as ee,ao as te}from"./pfen37nC.js";import{r as $}from"./CHxyi5eo.js";import{S as oe,a as ae,b as ne,P as se}from"./B8DQizlv.js";import{B as T}from"./DaTCy0-P.js";import{S as le,a as re}from"./BIMQPg20.js";import{I as G,_ as ie,F as ce}from"./BILk8unQ.js";import{M as H}from"./hDKACIxK.js";import{_ as pe}from"./CL9W64Bf.js";import{c as de}from"./BbeeQSgS.js";import{_ as ue}from"./4efXhTML.js";import"./zumCF4Wn.js";import"./D5PK9cSD.js";import"./D73PgFZk.js";import"./CuwMMC_f.js";import"./C5j99dGK.js";import"./D6oZlt4w.js";import"./DGYNie3Z.js";import"./CuvLPzjN.js";import"./YQznkyEo.js";import"./DL8rJm5r.js";import"./ZEWPwqxo.js";import"./CXPWXIeg.js";import"./vCu2co3e.js";const me={key:1},_e=A({__name:"RolesModal",props:{open:{type:Boolean},isEditing:{type:Boolean,default:!1},isLoading:{type:Boolean,default:!1},item:{default:()=>({})},title:{default:"Добавление роль"}},emits:["close","confirm"],setup(L,{emit:w}){const d=r(!1),M=P(),y=L,{open:j,isEditing:u,isLoading:R,item:k}=Q(y),v=w,m=r(null),b=async()=>{var s;d.value=!0;try{const c=await((s=m.value)==null?void 0:s.validateFields());if(c&&!c.errorFields){const S={company_id:M.getUser.owner.id,role:_.role},p=await $.create(S);v("confirm",p)}}catch(c){console.log(c)}finally{d.value=!1}},F=()=>{v("close")},_=V({role:""});return r(null),W(()=>k.value,s=>{u.value&&s&&(_.role=(s==null?void 0:s.role)??"")},{immediate:!0}),(s,c)=>{const S=oe,p=T,g=pe,h=ae,t=ne,e=le,f=G,I=ie,O=ce,E=H;return i(),x(E,{open:n(j),onCancel:F,onOk:b},{title:a(()=>[n(R)?(i(),x(S,{key:0,paragraph:{rows:0},active:""})):(i(),B("div",me,X(s.title),1))]),footer:a(()=>[n(u)?(i(),x(g,{key:0,justify:"space-between",wrap:"wrap"},{default:a(()=>[o(p,{type:"link",danger:""},{default:a(()=>[C("Удалить пользователя")]),_:1}),o(p,{type:"primary"},{default:a(()=>[C("Сохранить")]),_:1})]),_:1})):(i(),x(p,{key:"submit",type:"primary",loading:d.value,onClick:b},{default:a(()=>[C("Добавить")]),_:1},8,["loading"]))]),default:a(()=>[n(R)?(i(),x(e,{key:0,class:"w-[250px]",direction:"vertical"},{default:a(()=>[o(g,{justify:"space-between",wrap:"wrap"},{default:a(()=>[o(h,{active:""})]),_:1}),o(g,{justify:"space-between",wrap:"wrap"},{default:a(()=>[o(h,{active:""}),o(t,{active:""})]),_:1}),o(g,{justify:"space-between",wrap:"wrap"},{default:a(()=>[o(h,{class:"flex-grow",active:""})]),_:1}),o(g,{justify:"space-between",wrap:"wrap"},{default:a(()=>[o(h,{class:"flex-grow",active:""}),o(t,{active:""})]),_:1})]),_:1})):(i(),x(O,{key:1,ref_key:"clusterModal",ref:m,layout:"vertical",model:_,name:"basic",autocomplete:"off"},{default:a(()=>[o(I,{name:"role",class:"w-[340px]",rules:[{required:!0,message:"Введите новую роль"}]},{default:a(()=>[o(f,{value:_.role,"onUpdate:value":c[0]||(c[0]=q=>_.role=q),class:"text-gray-400",placeholder:"Название роли пользователя"},null,8,["value"])]),_:1})]),_:1},8,["model"]))]),_:1},8,["open"])}}}),fe={class:"h-full"},ye={class:"mt-4 pb-6 px-4 flex w-full items-center flex-wrap justify-between border-solid border-transparent border-b-gray-200 border-0 border-b-[1px]"},ve={class:"max-w-[400px] mt-4 w-full"},ge={class:"border-solid border-0 border-b-2 border-gray-400"},we={key:0},ke={key:1},He=A({__name:"index",setup(L){const w=r(!1),d=P(),M=r(null),y=r([]),j=async()=>{w.value=!0;try{const t=await de.show(d.getUser.owner.id);M.value=t}catch(t){console.log(t)}finally{w.value=!1}},u=async()=>{w.value=!0;try{const t=await $.list(d.getUser.owner.id);y.value=t,console.log("roles: ",y.value)}catch(t){console.log(t)}finally{w.value=!1}};Y(async()=>{await d.profile(),await j(),await u()});const R=[{name:"id",dataIndex:"id",key:"id"},{name:"Роль",dataIndex:"role",key:"role"},{title:"Действия",key:"action"}],k=r(!1),v=r(!1),m=r(!1),b=r(null),F=async t=>{try{_(),await u()}catch(e){console.log(e)}},_=()=>{k.value=!1,v.value=!1,b.value=null},s=()=>{k.value=!0},c=async t=>{H.confirm({title:`Вы точно хотите удалить пользователя ${t.role}?`,icon:z(te),async onOk(){try{await S(t.id),await u()}catch(e){console.log(e)}},onCancel(){}})},S=async t=>{try{const e={role_id:t},f=await $.delete(e);await u()}catch(e){console.log(e)}},p=r(""),g=async t=>{m.value=!0;try{const e=y.value.find(f=>f.id===t);console.log(e),e&&(k.value=!0,v.value=!0,b.value=e)}catch(e){console.log(e)}m.value=!1},h=async t=>{m.value=!0;try{if(!t.length)await u();else{const e=await $.searchRoles({find:t,company_id:d.getUser.owner.id});console.log(e),y.value=e}}catch(e){console.log(e)}finally{m.value=!1}};return(t,e)=>{const f=T,I=K,O=G,E=ue,q=_e;return i(),B("div",fe,[o(I,{class:"mt-4",title:"Роли"},{right:a(()=>[o(f,{type:"primary",size:"middle",icon:z(n(se)),onClick:e[0]||(e[0]=l=>s())},{default:a(()=>[C("Добавить роль")]),_:1},8,["icon"])]),_:1}),U("div",null,[U("div",ye,[U("div",ve,[U("div",ge,[o(O,{value:n(p),"onUpdate:value":e[1]||(e[1]=l=>Z(p)?p.value=l:null),bordered:!1,placeholder:"Поиск...",class:"text-gray-400",onChange:e[2]||(e[2]=l=>h(l.target.value))},{prefix:a(()=>[o(n(re),{size:16,color:"currentColor"})]),_:1},8,["value"])])])]),o(E,{columns:R,"data-source":n(y)},{headerCell:a(({column:l})=>[l.key==="id"?(i(),B("span",we," ID ")):D("",!0),l.key==="role"?(i(),B("span",ke," Роль ")):D("",!0)]),bodyCell:a(({column:l,record:N})=>[l.key==="action"?(i(),B(ee,{key:0},[o(f,{type:"link",danger:"",onClick:J=>c(N)},{default:a(()=>[C("Удалить")]),_:2},1032,["onClick"]),o(f,{type:"link",onClick:J=>g(N.id)},{default:a(()=>[C("Редактировать")]),_:2},1032,["onClick"])],64)):D("",!0)]),_:1},8,["data-source"])]),o(q,{open:n(k),"is-editing":n(v),"is-loading":n(m),title:n(v)?"Радактировать роль":"Добавление роль",item:n(b),onClose:e[3]||(e[3]=l=>_()),onConfirm:e[4]||(e[4]=l=>F())},null,8,["open","is-editing","is-loading","title","item"])])}}});export{He as default};
