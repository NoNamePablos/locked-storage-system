import{_ as P}from"./gDly06h5.js";import{_ as q,p as h,a as z,b as A}from"./7-JcZz81.js";import{q as D,r as n,z as F,A as K,o as d,c as Y,a as j,b as l,w as p,B as c,F as G,x as _,d as H,C as J,D as V}from"./72Tm0drb.js";import{_ as Q}from"./DD_U3oK2.js";import{u as U,S as W,_ as X,a as Z}from"./CxrCKDH3.js";import{_ as ee,L as te}from"./CLlITAd1.js";import{P as oe,S as ae}from"./CfYHM0-g.js";import{B as se}from"./BWi5ilZV.js";import"./BAlvlKMe.js";import"./_vq8pnsq.js";import"./W1NEtkwR.js";import"./5CQO_EzI.js";import"./CQJCkcqG.js";import"./BMA6RC22.js";import"./DxrL16iQ.js";import"./NYUDkq8_.js";import"./bHe5Oq27.js";import"./DGYNie3Z.js";import"./CLfbelQC.js";const ne={class:"h-full"},Ve=D({__name:"[id]",setup(le){const{typeOfView:R,changeTypeOfView:x}=U(W.RECORDS_TYPE),s=n(),a=n(!1),r=n(!1),f=n(!1),y=n(),v=F();console.log(v);const g=async()=>{a.value=!0;try{const t={cluster_id:v.params.id},e=await h.list(t);s.value=e.data,u.value=!!e.cluster.is_redactor,console.log("is redactor: ",u.value),console.log(s.value)}catch(t){console.log(t)}finally{a.value=!1}},u=n(!1),C=async t=>{a.value=!0;try{const e=await h.findById({record_id:t});console.log(e),y.value=e}catch(e){console.log(e)}finally{a.value=!1}};K(async()=>{await g()});const i=n(!1),k=()=>{i.value=!1,f.value=!1,r.value=!1,y.value=null},$=()=>{i.value=!0},E=async(t=null)=>{a.value=!0;try{await g(),k()}catch(e){console.log(e)}finally{a.value=!1}},B=async(t=0,e="create")=>{if(e==="create"&&(i.value=!0),e==="edit"){r.value=!0,f.value=!0;try{await C(t),i.value=!0}catch(m){console.log(m)}finally{r.value=!1}}if(e==="open"){r.value=!0,f.value=!0;try{await C(t),i.value=!0}catch(m){console.log(m)}finally{r.value=!1}}},O=n(""),S=async t=>{a.value=!0;try{if(!t.length)await g();else{const e=await h.search({find:t,cluster_id:+v.params.id});s.value=e}}catch(e){console.log(e)}finally{a.value=!1}};return(t,e)=>{const m=se,b=P,L=ae,N=A,T=te,I=ee,M=z;return d(),Y(G,null,[j("div",ne,[l(q,{class:"mt-4",name:"Хранилища",route:"/platform/company-cluster/"}),l(b,{title:"Записи хранилища"},{right:p(()=>[u.value?(d(),_(m,{key:0,type:"primary",size:"middle",icon:("h"in t?t.h:c(J))(c(oe)),onClick:e[0]||(e[0]=o=>$())},{default:p(()=>[H("Добавить пароль")]),_:1},8,["icon"])):V("",!0)]),_:1}),l(I,{class:"bg-white h-full"},{default:p(()=>[l(X,{search:O.value,"type-view":c(R),onChangeView:e[1]||(e[1]=o=>c(x)(o)),onSearch:e[2]||(e[2]=o=>S(o))},null,8,["search","type-view"]),l(T,{class:"mt-6 px-2 sm:px-4"},{default:p(()=>[s.value&&s.value.length===0?(d(),_(Q,{key:0,title:"Сейчас нет записей"})):V("",!0),a.value?(d(),_(L,{key:1})):(d(),_(Z,{key:2,items:s.value,"type-view":c(R),"button-text":"Добавить пароль",empty:s.value&&s.value.length===0,"is-edit-permission":u.value,onAdd:e[5]||(e[5]=o=>$())},{card:p(({item:o})=>[l(N,{"is-redactor":u.value,item:o,onOpen:e[3]||(e[3]=w=>B(w,"open")),onEdit:e[4]||(e[4]=w=>B(w,"edit"))},null,8,["is-redactor","item"])]),_:1},8,["items","type-view","empty","is-edit-permission"]))]),_:1})]),_:1})]),l(M,{"is-editing":f.value,"is-loading":r.value,item:y.value,open:i.value,"clusterd-id":c(v).params.id,onClose:e[6]||(e[6]=o=>k()),onConfirm:e[7]||(e[7]=o=>E(o))},null,8,["is-editing","is-loading","item","open","clusterd-id"])],64)}}});export{Ve as default};
